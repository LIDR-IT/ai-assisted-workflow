description = "Sincroniza toda la configuraci√≥n de AI (rules, skills, commands, agents, MCP, hooks)"

prompt = """

# Workflow de Sincronizaci√≥n AI Setup

Ejecuta el proceso completo de sincronizaci√≥n de la configuraci√≥n multi-agente.

## Tareas a realizar:

1. **Ejecutar sync-all.sh**
   - Sincroniza orchestrator desde `.agents/orchestrator/`
   - Sincroniza rules desde `.agents/rules/`
   - Sincroniza skills desde `.agents/skills/`
   - Sincroniza commands desde `.agents/commands/`
   - Sincroniza subagents desde `.agents/subagents/`
   - Sincroniza MCP configs desde `.agents/mcp/`
   - Sincroniza hooks desde `.agents/hooks/` (workflow automation)
     - **Cursor:** `protect-secrets-post.sh` (primero) + `auto-format.sh` (segundo)
     - **Claude/Gemini:** `protect-secrets.sh` + `auto-format.sh` + `notify.sh`

2. **Verificar sincronizaci√≥n**
   - Verificar symlinks de Cursor, Claude, Gemini
   - Verificar symlinks selectivos de Antigravity
   - Mostrar resumen del estado

3. **Reportar resultado**
   - Indicar √©xito o errores
   - Mostrar componentes sincronizados
   - Sugerir acciones si hay problemas

## Proceso:

Ejecuta los siguientes comandos en orden:

[Code block:]
# 1. Ejecutar sincronizaci√≥n completa
./.agents/sync-all.sh

# 2. Verificar symlinks del orchestrator
ls -la AGENTS.md CLAUDE.md GEMINI.md

# 3. Verificar symlinks principales
ls -la .cursor/rules .cursor/skills .cursor/commands .cursor/agents
ls -la .claude/rules .claude/skills .claude/commands .claude/agents
ls -la .gemini/rules .gemini/skills .gemini/commands .gemini/agents

# 4. Verificar Antigravity (no soporta subagents)
ls -la .agent/rules/ | grep "\\->"
ls -la .agent/skills/ | grep "\\->"
ls -la .agent/workflows/ | grep "\\->"

# 5. Verificar MCP configs existen
ls -la .cursor/mcp.json .claude/mcp.json .gemini/settings.json

# 6. Verificar hooks (git workflow automation)
ls -la .cursor/hooks/
ls -la .claude/hooks/
ls -la .gemini/hooks/

# 7. Validar configuraciones de hooks
jq . .cursor/hooks.json
jq .hooks .claude/settings.json
jq .hooks .gemini/settings.json

# 8. Verificar orden de hooks en Cursor (protect-secrets-post DEBE ser primero)
echo "Cursor hook order (should be protect-secrets-post first):"
jq '.hooks.afterFileEdit[0].command' .cursor/hooks.json


Presenta un resumen claro del resultado con:

- ‚úÖ Componentes sincronizados exitosamente
- ‚ö†Ô∏è Advertencias si las hay
- ‚ùå Errores que requieran atenci√≥n
- üìã Siguiente paso recomendado (si aplica)

## ‚ö†Ô∏è IMPORTANTE - Antigravity

Si est√°s usando Antigravity, **cierra y reabre el proyecto** despu√©s del sync para que detecte los cambios.

**Por qu√©:** Antigravity carga las rules en memoria al inicio y solo detecta cambios en archivos que se modifican DESPU√âS de haberlos cargado. El sync actualiza timestamps, pero Antigravity ya tiene las rules cacheadas.

**Limitaciones de Antigravity:**

- Hooks solo soportados a nivel global (`~/.gemini/antigravity/hooks/`), no a nivel proyecto
- Subagents no soportados (directorio `.agents/subagents/` no se sincroniza)

**Workflow recomendado:**

1. Ejecutar sync: `./.agents/sync-all.sh`
2. Cerrar proyecto en Antigravity
3. Reabrir proyecto
4. Las rules actualizadas se cargar√°n autom√°ticamente

## üîë IMPORTANTE - Cursor Hook Order

El orden de los hooks en Cursor es **CR√çTICO**:

json
{
  "afterFileEdit": [
    { "command": "protect-secrets-post.sh" }, // ‚Üê PRIMERO
    { "command": "auto-format.sh" } // ‚Üê SEGUNDO
  ]
}


**Por qu√©:** Si `auto-format.sh` se ejecuta primero y modifica el archivo, `protect-secrets-post.sh` no podr√° detectar correctamente el patr√≥n sensible para revertir con git.

**El sync-hooks.sh ya maneja este orden autom√°ticamente.**

## Hooks por Plataforma

| Hook                        | Claude Code     | Gemini CLI      | Cursor               |
| --------------------------- | --------------- | --------------- | -------------------- |
| **protect-secrets.sh**      | ‚úÖ PreToolUse   | ‚úÖ BeforeTool   | ‚ùå No beforeFileEdit |
| **protect-secrets-post.sh** | ‚ùå N/A          | ‚ùå N/A          | ‚úÖ afterFileEdit     |
| **auto-format.sh**          | ‚úÖ PostToolUse  | ‚úÖ AfterTool    | ‚úÖ afterFileEdit     |
| **notify.sh**               | ‚úÖ Notification | ‚úÖ Notification | ‚ùå No soportado      |

## üõ°Ô∏è Husky - Backup a Nivel de Proyecto

**Husky + lint-staged** funcionan como **backup para TODAS las plataformas**, no solo para Cursor:

- **Nivel:** Git hooks (proyecto completo)
- **Garantiza:** Formateo y validaci√≥n antes de commit
- **Plataformas afectadas:** Cursor, Claude Code, Gemini CLI, Antigravity
- **Ventaja:** Funciona incluso si los hooks de la plataforma fallan

**Estrategia multi-capa:**

1. **Hooks de plataforma** (Claude/Gemini/Cursor) - Primera l√≠nea de defensa, ejecutan en tiempo real
2. **Husky pre-commit** - Segunda l√≠nea de defensa, garantiza formateo antes de commit
3. **protect-secrets** - Bloquea commits con archivos sensibles (.env, .key, .pem)

**Configuraci√≥n:**

- `.husky/pre-commit` - Ejecuta lint-staged autom√°ticamente
- `package.json` - Define qu√© archivos formatear con Prettier
- Funciona para **cualquier desarrollador** usando git, independiente de su IDE/herramienta AI

## ‚ö†Ô∏è Limitaciones Conocidas por Plataforma

### Antigravity (4 limitaciones)

1. ‚ùå **Hooks a nivel proyecto:** Solo soporta hooks globales en `~/.gemini/antigravity/hooks/`
   - **Impacto:** No puede usar los hooks del proyecto
   - **Workaround:** Configurar hooks globalmente (afecta todos los proyectos)

2. ‚ùå **Subagents:** No soporta el directorio `.agents/subagents/`
   - **Impacto:** No puede usar doc-improver, ticket-enricher, pr-validator
   - **Workaround:** Ninguno disponible

3. ‚ùå **MCP a nivel proyecto:** Solo configuraci√≥n global
   - **Impacto:** MCP servers deben configurarse en `~/.gemini/antigravity/mcp_config.json`
   - **Workaround:** Configuraci√≥n manual global (ver `docs/guides/mcp/ANTIGRAVITY_LIMITATION.md`)

4. ‚ö†Ô∏è **Rules caching:** Cachea rules en memoria al inicio
   - **Impacto:** Cambios en rules no se detectan sin reload
   - **Workaround:** Cerrar y reabrir proyecto despu√©s del sync

### Gemini CLI (1 limitaci√≥n)

1. ‚ö†Ô∏è **Rules nativas:** No tiene soporte nativo para rules
   - **Impacto:** Funcionalidad limitada comparada con otras plataformas
   - **Workaround:** Se genera `GEMINI.md` como √≠ndice (workaround parcial)

### Cursor (4 limitaciones)

1. ‚ùå **Evento Notification:** No soporta eventos de notificaci√≥n
   - **Impacto:** `notify.sh` no funciona en Cursor
   - **Workaround:** Ninguno disponible

2. ‚ùå **PreToolUse/BeforeTool:** Solo tiene `afterFileEdit`, no `beforeFileEdit`
   - **Impacto:** `protect-secrets.sh` no puede bloquear ANTES de editar
   - **Workaround:** Husky pre-commit como segunda l√≠nea de defensa

3. ‚ö†Ô∏è **Formato de rules:** Requiere extensi√≥n `.mdc` en lugar de `.md`
   - **Impacto:** Rules deben convertirse
   - **Workaround:** `sync-rules.sh` auto-convierte `.md` ‚Üí `.mdc`

4. ‚ö†Ô∏è **Estructura de rules:** No soporta subdirectorios
   - **Impacto:** Rules deben estar en estructura plana
   - **Workaround:** `sync-rules.sh` auto-flatten la estructura

### Claude Code (0 limitaciones)

‚úÖ **Soporte completo** de todas las caracter√≠sticas del sistema multi-agente

## üìä Resumen de Limitaciones

**Total: 9 limitaciones conocidas**

- Antigravity: 4 limitaciones (2 cr√≠ticas, 2 workarounds)
- Gemini CLI: 1 limitaci√≥n (workaround parcial)
- Cursor: 4 limitaciones (2 cr√≠ticas, 2 con workarounds)
- Claude Code: 0 limitaciones ‚úÖ

### Matriz de Workarounds

| Limitaci√≥n        | Plataforma  | Workaround          | Estado             |
| ----------------- | ----------- | ------------------- | ------------------ |
| No rules nativo   | Gemini CLI  | GEMINI.md √≠ndice    | ‚ö†Ô∏è Parcial         |
| Rules flat        | Cursor      | Auto-flatten + .mdc | ‚úÖ Autom√°tico      |
| No PreToolUse     | Cursor      | Husky pre-commit    | ‚úÖ Backup efectivo |
| No Notification   | Cursor      | N/A                 | ‚ùå No disponible   |
| MCP global        | Antigravity | Setup manual global | ‚ö†Ô∏è Manual          |
| Rules caching     | Antigravity | Reload proyecto     | ‚ö†Ô∏è Manual          |
| No hooks proyecto | Antigravity | Hooks globales      | ‚ö†Ô∏è Afecta todos    |
| No subagents      | Antigravity | N/A                 | ‚ùå No disponible   |

### Recomendaciones por Plataforma

**Para m√°xima funcionalidad:**

- **Claude Code** - Plataforma recomendada (soporte completo)
- **Gemini CLI** - Buena opci√≥n (1 limitaci√≥n menor)
- **Cursor** - Funcional con workarounds (hooks limitados)
- **Antigravity** - Limitaciones significativas (requiere configuraci√≥n manual)
"""
